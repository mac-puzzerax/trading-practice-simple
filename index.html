<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TradeReps</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0f0f1a;
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* ===== SCREENS ===== */
        .screen { display: none; min-height: 100vh; }
        .screen.active { display: flex; flex-direction: column; }
        
        /* ===== HOME SCREEN ===== */
        .home {
            padding: 30px 20px;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        .home h1 {
            font-size: 3em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #00d4ff, #00ff88);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .home .tagline { color: #888; margin-bottom: 40px; font-size: 1.1em; }
        .home .stats-preview {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
        }
        .home .stat { text-align: center; }
        .home .stat-value { font-size: 2em; font-weight: bold; color: #00d4ff; }
        .home .stat-label { color: #666; font-size: 0.85em; }
        
        .start-btn {
            padding: 20px 60px;
            font-size: 1.2em;
            font-weight: bold;
            background: linear-gradient(135deg, #00ff88, #00cc6a);
            border: none;
            border-radius: 15px;
            color: #000;
            cursor: pointer;
            margin-bottom: 20px;
        }
        .start-btn:hover { transform: scale(1.05); }
        
        .settings-link {
            color: #666;
            text-decoration: underline;
            cursor: pointer;
            font-size: 0.9em;
        }
        
        /* ===== SETTINGS SCREEN ===== */
        .settings {
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }
        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        .settings h2 { color: #00d4ff; }
        .back-btn {
            background: none;
            border: 1px solid #333;
            color: #888;
            padding: 8px 20px;
            border-radius: 8px;
            cursor: pointer;
        }
        
        .setting-group {
            background: #1a1a2e;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .setting-group h3 {
            color: #fff;
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        .setting-group p {
            color: #666;
            font-size: 0.85em;
            margin-bottom: 15px;
        }
        
        .chip-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .chip {
            padding: 12px 20px;
            background: #0d1117;
            border: 2px solid #333;
            border-radius: 25px;
            color: #888;
            cursor: pointer;
            font-size: 0.95em;
            transition: all 0.2s;
        }
        .chip:hover { border-color: #00d4ff; color: #00d4ff; }
        .chip.selected {
            background: #00d4ff20;
            border-color: #00d4ff;
            color: #00d4ff;
        }
        .chip.buy.selected { background: #00ff8820; border-color: #00ff88; color: #00ff88; }
        .chip.short.selected { background: #ff6b6b20; border-color: #ff6b6b; color: #ff6b6b; }
        
        .save-settings-btn {
            width: 100%;
            padding: 18px;
            font-size: 1.1em;
            font-weight: bold;
            background: #00d4ff;
            border: none;
            border-radius: 12px;
            color: #000;
            cursor: pointer;
            margin-top: 20px;
        }
        
        /* ===== PRACTICE SCREEN (TINDER STYLE) ===== */
        .practice {
            height: 100vh;
            padding: 15px;
            padding-bottom: 0;
        }
        .practice-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 15px;
        }
        .practice-header h2 { color: #00d4ff; font-size: 1.2em; }
        .practice-stats {
            display: flex;
            gap: 15px;
        }
        .mini-stat { text-align: center; }
        .mini-stat .val { font-size: 1.3em; font-weight: bold; }
        .mini-stat .val.green { color: #00ff88; }
        .mini-stat .val.red { color: #ff6b6b; }
        .mini-stat .lbl { font-size: 0.7em; color: #666; }
        
        .card-container {
            flex: 1;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            touch-action: pan-y;
        }
        
        .card {
            position: absolute;
            width: 100%;
            max-width: 400px;
            background: #1a1a2e;
            border-radius: 20px;
            padding: 20px;
            border: 1px solid #333;
            transform-origin: center;
            transition: transform 0.1s;
            user-select: none;
        }
        .card.swiping { transition: none; }
        .card.exiting { transition: transform 0.3s ease-out, opacity 0.3s ease-out; }
        
        .card-badge {
            position: absolute;
            top: 20px;
            padding: 10px 25px;
            border-radius: 10px;
            font-size: 1.5em;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .card-badge.valid { right: 20px; background: #00ff8830; color: #00ff88; border: 3px solid #00ff88; }
        .card-badge.invalid { left: 20px; background: #ff6b6b30; color: #ff6b6b; border: 3px solid #ff6b6b; }
        
        .card-ticker {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .card-ticker .symbol { font-size: 1.4em; font-weight: bold; color: #00d4ff; }
        .card-ticker .change { background: #00ff8830; color: #00ff88; padding: 5px 12px; border-radius: 10px; }
        .card-ticker .direction { font-size: 0.9em; color: #888; }
        
        .card-chart {
            background: #0d1117;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .candle-area {
            display: flex;
            align-items: flex-end;
            justify-content: center;
            gap: 4px;
            height: 150px;
            position: relative;
            margin-left: 40px;
        }
        .price-axis {
            position: absolute;
            left: 5px;
            top: 10px;
            bottom: 10px;
            width: 35px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            font-size: 0.65em;
            color: #666;
            text-align: right;
        }
        .candle { display: flex; flex-direction: column; align-items: center; position: relative; width: 14px; }
        .candle-body { width: 10px; border-radius: 2px; min-height: 5px; }
        .candle-wick { width: 2px; position: absolute; }
        .candle.green .candle-body, .candle.green .candle-wick { background: #00ff88; }
        .candle.red .candle-body, .candle.red .candle-wick { background: #ff6b6b; }
        .support-line { position: absolute; left: 0; right: 0; height: 2px; background: #f7b731; bottom: 40px; }
        
        .volume-area {
            display: flex;
            align-items: flex-end;
            justify-content: center;
            gap: 4px;
            height: 45px;
            border-top: 1px solid #333;
            padding-top: 8px;
            margin-top: 8px;
            margin-left: 40px;
        }
        .vol-bar { width: 10px; border-radius: 2px 2px 0 0; min-height: 4px; }
        .vol-bar.green { background: #00ff8880; }
        .vol-bar.red { background: #ff6b6b80; }
        .vol-bar.high { background: #00d4ff90; }
        
        .card-setup {
            background: #0d111780;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 15px;
        }
        .card-setup h4 { color: #00d4ff; margin-bottom: 8px; font-size: 1em; }
        .card-setup ul { list-style: none; font-size: 0.85em; }
        .card-setup li { padding: 4px 0; color: #aaa; padding-left: 15px; position: relative; }
        .card-setup li:before { content: "‚Ä¢"; position: absolute; left: 0; color: #00d4ff; }
        
        .card-indicators {
            display: flex;
            gap: 8px;
            justify-content: center;
        }
        .ind { padding: 6px 12px; background: #0d1117; border-radius: 6px; font-size: 0.8em; }
        .ind.pass { color: #00ff88; border: 1px solid #00ff8840; }
        .ind.fail { color: #ff6b6b; border: 1px solid #ff6b6b40; }
        
        /* Action buttons */
        .action-bar {
            display: flex;
            justify-content: center;
            gap: 30px;
            padding: 20px;
        }
        .action-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: none;
            font-size: 1.8em;
            cursor: pointer;
            transition: transform 0.15s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .action-btn:hover { transform: scale(1.1); }
        .action-btn.invalid-btn { background: #ff6b6b; color: #fff; }
        .action-btn.valid-btn { background: #00ff88; color: #000; }
        .action-btn:disabled { opacity: 0.4; transform: none !important; }
        
        /* Feedback overlay */
        .feedback-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
            padding: 20px;
        }
        .feedback-overlay.show { display: flex; }
        .feedback-content {
            background: #1a1a2e;
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            text-align: center;
        }
        .feedback-icon { font-size: 4em; margin-bottom: 15px; }
        .feedback-title { font-size: 1.5em; margin-bottom: 10px; }
        .feedback-title.correct { color: #00ff88; }
        .feedback-title.wrong { color: #ff6b6b; }
        .feedback-text { color: #aaa; margin-bottom: 25px; line-height: 1.5; }
        .feedback-btn {
            padding: 15px 40px;
            background: #00d4ff;
            border: none;
            border-radius: 10px;
            color: #000;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
        }
        
        /* ===== RESPONSIVE ===== */
        @media (max-width: 500px) {
            .home h1 { font-size: 2.2em; }
            .card { padding: 15px; }
            .candle-area { height: 120px; }
            .action-btn { width: 60px; height: 60px; font-size: 1.5em; }
        }
    </style>
</head>
<body>
    <!-- HOME SCREEN -->
    <div class="screen home active" id="screen-home">
        <h1>üéØ TradeReps</h1>
        <p class="tagline">Practice setups. Build muscle memory.</p>
        
        <div class="stats-preview">
            <div class="stat">
                <div class="stat-value" id="home-total">0</div>
                <div class="stat-label">Completed</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="home-accuracy">--%</div>
                <div class="stat-label">Accuracy</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="home-best">0</div>
                <div class="stat-label">Best Streak</div>
            </div>
        </div>
        
        <button class="start-btn" onclick="startPractice()">Start Practice</button>
        <span class="settings-link" onclick="showScreen('settings')">‚öôÔ∏è Settings & Filters</span>
    </div>
    
    <!-- SETTINGS SCREEN -->
    <div class="screen settings" id="screen-settings">
        <div class="settings-header">
            <h2>‚öôÔ∏è Practice Settings</h2>
            <button class="back-btn" onclick="showScreen('home')">‚Üê Back</button>
        </div>
        
        <div class="setting-group">
            <h3>üìä Setups to Practice</h3>
            <p>Select which setups you want to see</p>
            <div class="chip-group" id="setup-chips"></div>
        </div>
        
        <div class="setting-group">
            <h3>üìà Direction</h3>
            <p>Practice buying, shorting, or both</p>
            <div class="chip-group">
                <div class="chip buy selected" data-dir="long" onclick="toggleDir(this)">üü¢ Long (Buy)</div>
                <div class="chip short" data-dir="short" onclick="toggleDir(this)">üî¥ Short (Sell)</div>
            </div>
        </div>
        
        <div class="setting-group">
            <h3>üéØ Difficulty</h3>
            <p>Choose what scenarios to include</p>
            <div class="chip-group">
                <div class="chip selected" data-diff="both" onclick="toggleDiff(this)">All (Valid & Invalid)</div>
                <div class="chip" data-diff="valid" onclick="toggleDiff(this)">Valid Only</div>
                <div class="chip" data-diff="invalid" onclick="toggleDiff(this)">Invalid Only</div>
            </div>
        </div>
        
        <button class="save-settings-btn" onclick="saveAndStart()">üí™ Start Training</button>
    </div>
    
    <!-- PRACTICE SCREEN -->
    <div class="screen practice" id="screen-practice">
        <div class="practice-header">
            <button class="back-btn" onclick="showScreen('home')" style="padding:6px 12px;">‚úï</button>
            <h2 id="practice-setup-name">Practice</h2>
            <div class="practice-stats">
                <div class="mini-stat"><div class="val green" id="p-correct">0</div><div class="lbl">‚úì</div></div>
                <div class="mini-stat"><div class="val red" id="p-wrong">0</div><div class="lbl">‚úó</div></div>
            </div>
        </div>
        
        <div class="card-container" id="card-container">
            <div class="card" id="card">
                <div class="card-badge valid">VALID</div>
                <div class="card-badge invalid">SKIP</div>
                
                <div class="card-ticker">
                    <div>
                        <span class="symbol" id="c-ticker">NVDA</span>
                        <span class="direction" id="c-dir">Long</span>
                    </div>
                    <span class="change" id="c-change">+12.5%</span>
                </div>
                
                <div class="card-chart">
                    <div class="candle-area" id="c-candles"></div>
                    <div class="volume-area" id="c-volume"></div>
                </div>
                
                <div class="card-setup">
                    <h4 id="c-setup-name">Setup Name</h4>
                    <ul id="c-rules"></ul>
                </div>
                
                <div class="card-indicators" id="c-indicators"></div>
            </div>
        </div>
        
        <div class="action-bar">
            <button class="action-btn invalid-btn" id="btn-invalid" onclick="answer(false)">‚úó</button>
            <button class="action-btn valid-btn" id="btn-valid" onclick="answer(true)">‚úì</button>
        </div>
    </div>
    
    <!-- FEEDBACK OVERLAY -->
    <div class="feedback-overlay" id="feedback-overlay">
        <div class="feedback-content">
            <div class="feedback-icon" id="fb-icon">‚úì</div>
            <div class="feedback-title" id="fb-title">Correct!</div>
            <p class="feedback-text" id="fb-text">Explanation here...</p>
            <button class="feedback-btn" onclick="nextCard()">Next ‚Üí</button>
        </div>
    </div>

    <script>
        // ============== DATA ==============
        const SETUPS = [
            {
                id: 'parabolic', name: 'Parabolic Washout', type: 'PARABOLIC', direction: 'long',
                rules: ['All green candles', '5+ green on 3-min', 'First pullback to support', 'No 2nd red'],
                scenarios: [
                    { c: 'g,g,g,g,g,G,G,G,G,g,g,g-', v: '1,1,1,1.5,2,3,3.5,3,2,1.5,1,0.8', valid: true, reason: '‚úÖ Perfect setup - all green, volume climax, healthy pullback.' },
                    { c: 'g,g,g,G,G,G,G,g,g,g-', v: '1,1.5,2,3,4,3.5,3,2,1.5,1', valid: true, reason: '‚úÖ Strong momentum, first pullback with volume dry-up.' },
                    { c: 'g,g,G,G,G,G,g,g,g,g-', v: '1,2,3,4,4,3,2,1.5,1,0.8', valid: true, reason: '‚úÖ Clean structure, testing support for first time.' },
                    { c: 'g,g,g,g,G,G,G,g,g,g-', v: '1,1,1.5,2,4,3,2.5,1.5,1,0.8', valid: true, reason: '‚úÖ Nice build-up, volume confirms, pullback is healthy.' },
                    { c: 'g,g,g,G,G,G,G,G,g,g-', v: '1,1.5,2,3,3.5,4,3.5,3,2,1.5', valid: true, reason: '‚úÖ Extended but valid first touch of support.' },
                    { c: 'g,g,g,g,r,g,g,r,r,g', v: '1,1,1,1,2,1,1,2,2,1', valid: false, reason: '‚ùå Mixed candles - no parabolic move, avoid.' },
                    { c: 'g,g,g,G,G,G,r,r,g', v: '1,2,2,3,3,2,3,3,1', valid: false, reason: '‚ùå Second red at support - selling pressure.' },
                    { c: 'g,g,G,G,G,G,G,G', v: '1,2,3,4,4,3,3,2', valid: false, reason: '‚ùå No pullback yet - would be chasing.' },
                    { c: 'g,r,g,g,r,g,G,g', v: '1,1,1,1,1,1,2,1', valid: false, reason: '‚ùå Choppy start, not clean parabolic.' },
                    { c: 'g,g,g,G,G,r,g,r,g', v: '1,1,2,3,3,2,1,2,1', valid: false, reason: '‚ùå Failed to hold gains, weakness showing.' }
                ]
            },
            {
                id: 'vwap', name: 'VWAP Reclaim', type: 'VWAP', direction: 'long',
                rules: ['Was below VWAP', 'Reclaimed with volume', 'Holding above VWAP', 'First pullback to VWAP'],
                scenarios: [
                    { c: 'r,r,r,r,g,G,G,g,g,g,g-', v: '1,1,1,1,2,3,3,2,1.5,1,0.8', valid: true, reason: '‚úÖ Clean VWAP reclaim with volume, first test.' },
                    { c: 'r,r,r,g,g,G,G,g,g,g-', v: '1,1,1,1.5,2,3,2.5,2,1.5,1', valid: true, reason: '‚úÖ Gradual reclaim, testing VWAP from above.' },
                    { c: 'R,r,r,g,G,G,g,g,g-', v: '2,1,1,2,3,2.5,2,1.5,1', valid: true, reason: '‚úÖ Strong reversal, reclaimed and holding.' },
                    { c: 'r,r,r,r,r,g,G,G,g,g,g-', v: '1,1,1,1,1,2,4,3,2,1.5,1', valid: true, reason: '‚úÖ Extended sell then powerful reclaim.' },
                    { c: 'r,r,g,G,G,G,g,g,g-', v: '1,1,2,3,3.5,3,2,1.5,1', valid: true, reason: '‚úÖ Quick reclaim with conviction.' },
                    { c: 'r,g,r,g,r,g,r,g', v: '1,1,1,1,1,1,1,1', valid: false, reason: '‚ùå Chopping around VWAP - no control.' },
                    { c: 'r,r,g,g,r,r,g', v: '1,1,2,1,2,2,1', valid: false, reason: '‚ùå Failed reclaim, back below.' },
                    { c: 'r,r,r,g,r,g,r', v: '1,1,1,1,1,1,1', valid: false, reason: '‚ùå Can\'t hold above VWAP.' },
                    { c: 'r,g,g,r,r,r,g', v: '1,1,1,2,2,1,1', valid: false, reason: '‚ùå Bearish continuation.' },
                    { c: 'r,r,g,g,g,r,r', v: '1,1,1,1,1,2,2', valid: false, reason: '‚ùå Reclaim failed with selling.' }
                ]
            },
            {
                id: 'r2g', name: 'Red to Green', type: 'R2G', direction: 'long',
                rules: ['Stock was RED', 'Crossed to GREEN', 'Timeframes aligned', 'First pullback to zero line'],
                scenarios: [
                    { c: 'r,r,r,R,g,G,G,G,g,g,g-', v: '1,1,1,2,2,3,3,2,1.5,1,0.8', valid: true, reason: '‚úÖ Classic R2G, shorts trapped.' },
                    { c: 'r,r,R,g,g,G,G,g,g,g-', v: '1,1,2,2,2,3,2.5,2,1.5,1', valid: true, reason: '‚úÖ Sharp reversal, testing the flip.' },
                    { c: 'R,r,r,g,G,G,g,g,g-', v: '2,1,1,2,3,3,2,1.5,1', valid: true, reason: '‚úÖ Capitulation then reversal.' },
                    { c: 'r,r,r,g,g,g,G,G,g,g-', v: '1,1,1,1.5,2,2,3,2.5,2,1', valid: true, reason: '‚úÖ Building momentum through green.' },
                    { c: 'r,R,g,G,G,G,g,g,g-', v: '1,2,2,3,3.5,3,2,1.5,1', valid: true, reason: '‚úÖ V-bottom reversal, strong R2G.' },
                    { c: 'r,r,g,r,g,r,g', v: '1,1,1,1,1,1,1', valid: false, reason: '‚ùå Fighting at zero line - no winner.' },
                    { c: 'r,g,r,r,r,g', v: '1,1,2,2,1,1', valid: false, reason: '‚ùå Weak bounce, sellers in control.' },
                    { c: 'r,r,g,g,r,r,r', v: '1,1,1,1,2,2,1', valid: false, reason: '‚ùå R2G failed, back to red.' },
                    { c: 'r,g,g,r,r,g,r', v: '1,1,1,1,1,1,1', valid: false, reason: '‚ùå Can\'t hold green.' },
                    { c: 'r,r,r,g,r,r', v: '1,1,1,1,2,1', valid: false, reason: '‚ùå Dead cat bounce.' }
                ]
            },
            {
                id: 'hod', name: 'HOD Breakout', type: 'HOD', direction: 'long',
                rules: ['Broke High of Day', 'Volume on break', 'All timeframes aligned', 'First pullback to old HOD'],
                scenarios: [
                    { c: 'g,g,g,g,G,G,g,g,g-', v: '1,1,1,2,4,3,2,1.5,1', valid: true, reason: '‚úÖ Clean HOD break, first retest.' },
                    { c: 'g,g,g,G,G,G,g,g,g-', v: '1,1,2,3,4,3,2,1.5,1', valid: true, reason: '‚úÖ Strong breakout, healthy pullback.' },
                    { c: 'g,g,G,G,g,g,G,g,g-', v: '1,2,3,3,2,2,3,2,1', valid: true, reason: '‚úÖ Multiple pushes, testing.' },
                    { c: 'g,r,g,g,G,G,g,g,g-', v: '1,1,1,2,4,3,2,1.5,1', valid: true, reason: '‚úÖ Shakeout before break.' },
                    { c: 'g,g,g,G,G,G,G,g,g-', v: '1,1.5,2,3,3.5,3,2.5,2,1.5', valid: true, reason: '‚úÖ Trending day, HOD break.' },
                    { c: 'g,g,g,G,r,r,g', v: '1,1,2,3,2,2,1', valid: false, reason: '‚ùå Failed breakout, rejected.' },
                    { c: 'g,r,g,r,g,G,r', v: '1,1,1,1,1,2,1', valid: false, reason: '‚ùå Choppy, no clean break.' },
                    { c: 'g,g,G,r,r,r,g', v: '1,1,3,2,2,1,1', valid: false, reason: '‚ùå HOD rejection, bearish.' },
                    { c: 'g,g,g,g,r,g,r', v: '1,1,1,1,1,1,1', valid: false, reason: '‚ùå Can\'t break HOD.' },
                    { c: 'g,G,r,r,g,r,r', v: '1,3,2,1,1,1,1', valid: false, reason: '‚ùå Spike and fade.' }
                ]
            },
            {
                id: 'ema', name: '9 EMA Bounce', type: 'EMA', direction: 'long',
                rules: ['Strong uptrend', 'Riding 9 EMA', 'All TFs above EMA', 'First touch of EMA'],
                scenarios: [
                    { c: 'g,g,G,g,g,G,g,g,g-', v: '1,1,2,1.5,1,2,1.5,1,0.8', valid: true, reason: '‚úÖ Clean trend, first EMA touch.' },
                    { c: 'g,G,g,g,g,G,g,g-', v: '1,2,1.5,1,1,2,1.5,1', valid: true, reason: '‚úÖ Higher highs, EMA support.' },
                    { c: 'G,g,g,g,g,g,G,g,g-', v: '2,1.5,1,1,1,1,2,1.5,1', valid: true, reason: '‚úÖ Trend intact, EMA entry.' },
                    { c: 'g,g,g,G,g,g,g,g-', v: '1,1,1.5,2,1.5,1,1,0.8', valid: true, reason: '‚úÖ Smooth trend, EMA bounce.' },
                    { c: 'g,G,G,g,g,g,g,g-', v: '1,2,2.5,2,1.5,1,1,0.8', valid: true, reason: '‚úÖ Strong move, testing EMA.' },
                    { c: 'g,g,r,g,r,g,r', v: '1,1,1,1,1,1,1', valid: false, reason: '‚ùå Lost EMA, trend broken.' },
                    { c: 'g,r,r,g,g,r,r', v: '1,2,2,1,1,2,2', valid: false, reason: '‚ùå EMA broken with volume.' },
                    { c: 'G,r,r,r,g,r', v: '2,1,1,1,1,1', valid: false, reason: '‚ùå Trend exhaustion.' },
                    { c: 'g,g,r,r,g,r,r', v: '1,1,1,1,1,1,1', valid: false, reason: '‚ùå No trend, random chop.' },
                    { c: 'g,G,r,r,r,g', v: '1,2,2,1,1,1', valid: false, reason: '‚ùå Breakdown, not bounce.' }
                ]
            }
        ];
        
        let settings = {
            setups: ['parabolic', 'vwap', 'r2g', 'hod', 'ema'],
            directions: ['long'],
            difficulty: 'both'
        };
        
        let stats = JSON.parse(localStorage.getItem('tradereps-stats') || '{"correct":0,"wrong":0,"best":0}');
        let current = null;
        let currentStreak = 0;
        
        // ============== SCREENS ==============
        function showScreen(name) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('screen-' + name).classList.add('active');
        }
        
        // ============== HOME ==============
        function updateHomeStats() {
            const total = stats.correct + stats.wrong;
            document.getElementById('home-total').textContent = total;
            document.getElementById('home-accuracy').textContent = total > 0 ? Math.round((stats.correct/total)*100) + '%' : '--%';
            document.getElementById('home-best').textContent = stats.best;
        }
        
        // ============== SETTINGS ==============
        function initSettings() {
            const chips = document.getElementById('setup-chips');
            chips.innerHTML = '<div class="chip selected" data-setup="all" onclick="toggleSetup(this)">All Setups</div>';
            SETUPS.forEach(s => {
                chips.innerHTML += `<div class="chip" data-setup="${s.id}" onclick="toggleSetup(this)">${s.name}</div>`;
            });
        }
        
        function toggleSetup(el) {
            const setup = el.dataset.setup;
            if (setup === 'all') {
                // Select all - clear others and select "all"
                document.querySelectorAll('[data-setup]').forEach(c => c.classList.remove('selected'));
                el.classList.add('selected');
                settings.setups = SETUPS.map(s => s.id);
            } else {
                // Toggle individual setup
                document.querySelector('[data-setup="all"]').classList.remove('selected');
                el.classList.toggle('selected');
                
                // Get all selected setups
                const selected = [...document.querySelectorAll('[data-setup].selected:not([data-setup="all"])')]
                    .map(c => c.dataset.setup);
                
                settings.setups = selected;
                
                // If all are selected, show "All" as selected
                if (selected.length === SETUPS.length) {
                    document.querySelectorAll('[data-setup]').forEach(c => c.classList.remove('selected'));
                    document.querySelector('[data-setup="all"]').classList.add('selected');
                }
                
                // If none selected, default to all
                if (settings.setups.length === 0) {
                    document.querySelector('[data-setup="all"]').classList.add('selected');
                    settings.setups = SETUPS.map(s => s.id);
                }
            }
            updateSelectedCount();
        }
        
        function updateSelectedCount() {
            const count = settings.setups.length;
            const allBtn = document.querySelector('[data-setup="all"]');
            if (count === SETUPS.length) {
                allBtn.textContent = 'All Setups';
            } else {
                allBtn.textContent = `All Setups (${count} selected)`;
            }
        }
        
        function toggleDir(el) {
            el.classList.toggle('selected');
            settings.directions = [...document.querySelectorAll('[data-dir].selected')].map(c => c.dataset.dir);
            if (settings.directions.length === 0) {
                el.classList.add('selected');
                settings.directions = [el.dataset.dir];
            }
        }
        
        function toggleDiff(el) {
            document.querySelectorAll('[data-diff]').forEach(c => c.classList.remove('selected'));
            el.classList.add('selected');
            settings.difficulty = el.dataset.diff;
        }
        
        function saveAndStart() {
            startPractice();
        }
        
        // ============== PRACTICE ==============
        function startPractice() {
            currentStreak = 0;
            showScreen('practice');
            loadCard();
        }
        
        function loadCard() {
            // Filter setups
            let available = SETUPS.filter(s => settings.setups.includes(s.id));
            if (available.length === 0) available = SETUPS;
            
            const setup = available[Math.floor(Math.random() * available.length)];
            let scenarios = setup.scenarios;
            
            if (settings.difficulty === 'valid') scenarios = scenarios.filter(s => s.valid);
            else if (settings.difficulty === 'invalid') scenarios = scenarios.filter(s => !s.valid);
            
            const scenario = scenarios[Math.floor(Math.random() * scenarios.length)];
            current = { setup, ...scenario };
            
            // Update UI
            document.getElementById('practice-setup-name').textContent = setup.name;
            document.getElementById('c-setup-name').textContent = setup.name;
            document.getElementById('c-rules').innerHTML = setup.rules.map(r => `<li>${r}</li>`).join('');
            document.getElementById('c-dir').textContent = setup.direction === 'long' ? 'üìà Long' : 'üìâ Short';
            
            const tickers = ['NVDA','TSLA','AMD','SMCI','MARA','IONQ','RGTI','PLTR','COIN','MSTR'];
            document.getElementById('c-ticker').textContent = tickers[Math.floor(Math.random()*tickers.length)];
            document.getElementById('c-change').textContent = `+${(5+Math.random()*20).toFixed(1)}%`;
            
            drawCard(scenario.c.split(','), scenario.v.split(',').map(Number));
            
            // Reset card position
            const card = document.getElementById('card');
            card.style.transform = '';
            card.style.opacity = '1';
            document.querySelector('.card-badge.valid').style.opacity = '0';
            document.querySelector('.card-badge.invalid').style.opacity = '0';
            
            document.getElementById('btn-valid').disabled = false;
            document.getElementById('btn-invalid').disabled = false;
        }
        
        function drawCard(candles, volumes) {
            const area = document.getElementById('c-candles');
            const volArea = document.getElementById('c-volume');
            area.innerHTML = '<div class="support-line"></div>';
            volArea.innerHTML = '';
            
            // Add price axis
            const basePrice = 20 + Math.random() * 60;
            const priceAxis = document.createElement('div');
            priceAxis.className = 'price-axis';
            priceAxis.innerHTML = `
                <span>$${(basePrice + 5).toFixed(2)}</span>
                <span>$${(basePrice + 2.5).toFixed(2)}</span>
                <span>$${basePrice.toFixed(2)}</span>
            `;
            area.parentElement.insertBefore(priceAxis, area);
            
            // Remove old price axis if exists
            const oldAxis = area.parentElement.querySelectorAll('.price-axis');
            if (oldAxis.length > 1) oldAxis[0].remove();
            
            let greenCount = 0;
            const maxVol = Math.max(...volumes);
            
            candles.forEach((c, i) => {
                const isGreen = c.includes('g') || c.includes('G');
                const isBig = c.includes('G') || c.includes('R');
                const isPullback = c.includes('-');
                if (isGreen) greenCount++;
                else greenCount = 0;
                
                const div = document.createElement('div');
                div.className = `candle ${isGreen ? 'green' : 'red'}`;
                
                const bodyH = isBig ? (35 + Math.random()*20) : (10 + Math.random()*18);
                const wickT = 2 + Math.random()*6;
                const wickB = isPullback ? (8 + Math.random()*5) : (2 + Math.random()*5);
                
                div.innerHTML = `
                    <div class="candle-wick" style="height:${wickT}px;bottom:${bodyH}px"></div>
                    <div class="candle-body" style="height:${bodyH}px"></div>
                    <div class="candle-wick" style="height:${wickB}px;bottom:${-wickB}px"></div>
                `;
                
                const bottom = 35 + (isBig ? 10 : 0) + (i * 3) + (isGreen ? 3 : -2);
                div.style.marginBottom = bottom + 'px';
                area.appendChild(div);
                
                // Volume bar - scaled relative to max volume
                const vol = document.createElement('div');
                const volHeight = (volumes[i] / maxVol) * 35; // Max 35px
                const isHighVol = volumes[i] >= maxVol * 0.8;
                vol.className = `vol-bar ${isGreen ? 'green' : 'red'} ${isHighVol ? 'high' : ''}`;
                vol.style.height = Math.max(4, volHeight) + 'px';
                volArea.appendChild(vol);
            });
            
            // Indicators
            document.getElementById('c-indicators').innerHTML = `
                <div class="ind ${greenCount >= 5 ? 'pass' : 'fail'}">1m: ${greenCount} green</div>
                <div class="ind ${greenCount >= 4 ? 'pass' : 'fail'}">3m: ~${Math.ceil(greenCount*0.7)}</div>
            `;
        }
        
        // ============== SWIPE ==============
        let startX = 0, currentX = 0, isDragging = false;
        const card = document.getElementById('card');
        const container = document.getElementById('card-container');
        
        container.addEventListener('touchstart', e => {
            startX = e.touches[0].clientX;
            isDragging = true;
            card.classList.add('swiping');
        });
        
        container.addEventListener('touchmove', e => {
            if (!isDragging) return;
            currentX = e.touches[0].clientX - startX;
            card.style.transform = `translateX(${currentX}px) rotate(${currentX * 0.05}deg)`;
            
            const validBadge = document.querySelector('.card-badge.valid');
            const invalidBadge = document.querySelector('.card-badge.invalid');
            validBadge.style.opacity = Math.min(1, currentX / 100);
            invalidBadge.style.opacity = Math.min(1, -currentX / 100);
        });
        
        container.addEventListener('touchend', () => {
            isDragging = false;
            card.classList.remove('swiping');
            
            if (currentX > 100) {
                answer(true);
            } else if (currentX < -100) {
                answer(false);
            } else {
                card.style.transform = '';
                document.querySelector('.card-badge.valid').style.opacity = '0';
                document.querySelector('.card-badge.invalid').style.opacity = '0';
            }
            currentX = 0;
        });
        
        // ============== ANSWER ==============
        function answer(saidValid) {
            const isCorrect = saidValid === current.valid;
            
            // Animate card exit
            const card = document.getElementById('card');
            card.classList.add('exiting');
            card.style.transform = `translateX(${saidValid ? 300 : -300}px) rotate(${saidValid ? 20 : -20}deg)`;
            card.style.opacity = '0';
            
            // Update stats
            if (isCorrect) {
                stats.correct++;
                currentStreak++;
                if (currentStreak > stats.best) stats.best = currentStreak;
            } else {
                stats.wrong++;
                currentStreak = 0;
            }
            localStorage.setItem('tradereps-stats', JSON.stringify(stats));
            
            document.getElementById('p-correct').textContent = stats.correct;
            document.getElementById('p-wrong').textContent = stats.wrong;
            
            // Show feedback
            setTimeout(() => {
                document.getElementById('fb-icon').textContent = isCorrect ? '‚úÖ' : '‚ùå';
                document.getElementById('fb-title').textContent = isCorrect ? 'Correct!' : 'Wrong';
                document.getElementById('fb-title').className = `feedback-title ${isCorrect ? 'correct' : 'wrong'}`;
                document.getElementById('fb-text').textContent = current.reason;
                document.getElementById('feedback-overlay').classList.add('show');
            }, 200);
            
            document.getElementById('btn-valid').disabled = true;
            document.getElementById('btn-invalid').disabled = true;
        }
        
        function nextCard() {
            document.getElementById('feedback-overlay').classList.remove('show');
            const card = document.getElementById('card');
            card.classList.remove('exiting');
            loadCard();
        }
        
        // ============== INIT ==============
        initSettings();
        updateHomeStats();
    </script>
</body>
</html>
